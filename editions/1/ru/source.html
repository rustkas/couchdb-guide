<title>Installing from Source</title>

<meta charset="utf-8">

<link rel="stylesheet" href="../../../style.css">

<link rel="prev" href="windows.html">

<link rel="next" href="json.html">

<script src="../../../script.js"></script>

<h2 id="source">Installing from Source</h2>

<p>Вообще говоря, вам следует избегать установки из исходного кода. Многие операционные системы предоставляют менеджеры пакетов, которые позволят вам загрузить и установить CouchDB с помощью одной команды. Эти менеджеры пакетов обычно заботятся о правильной настройке, управлении безопасностью и обеспечении правильного запуска и остановки базы данных CouchDB вашей системой. Первые несколько приложений показали, как установить пакеты CouchDB для Unix-подобных, Mac OS X и Windows операционных систем. Если вы не можете следовать этим инструкциям или вам нужно установить его вручную по другим причинам, эта глава для вас.
<h3 id="dependencies">Зависимости</h3>

<p>Для сборки и установки CouchDB вам потребуется установить набор другого программного обеспечения, от которого зависит CouchDB. Без этого программного обеспечения, должным образом установленного в вашей системе, CouchDB не будет работать. Вам необходимо скачать и установить следующее:
<ul>

<li><a href="http://erlang.org/">Erlang OTP</a>(&gt;=R12B)</li>

<li><a href="http://icu.sourceforge.net/">ICU</a></li>

<li><a href="http://www.openssl.org/">OpenSSL</a></li>

<li><a href="http://www.mozilla.org/js/spidermonkey/">Mozilla SpiderMonkey</a></li>

<li><a href="http://curl.haxx.se/libcurl/">libcurl</a></li>

<li><a href="http://www.gnu.org/software/make/">GNU Make</a></li>

<li><a href="http://gcc.gnu.org/">GNU Compiler Collection</a></li>

</ul>

<p>Рекомендуется установить Erlang OTP R12B-5 или выше, если это возможно.
<p>Каждый из этих пакетов программного обеспечения должен содержать пользовательские инструкции по установке на веб-сайте или в загружаемом архиве. Однако, если вам повезет, вы можете использовать менеджер пакетов для установки этих зависимостей.
<h4 id="debian">Системы на основе Debian (включая Ubuntu)</h4>

<p>Вы можете установить зависимости, запустив:

<pre>
apt-get install build-essential erlang libicu-dev libmozjs-dev libcurl4-openssl-dev
</pre>

<p>Если вы получили ошибку в любом из этих пакетов, обязательно проверьте текущую версию, предлагаемую вашим дистрибутивом. Может случиться так, что была выпущена более новая версия и имя пакета было изменено. Например, вы можете искать новейший пакет ICU, выполнив:
<pre>
apt-cache search libicu
</pre>

<p>Выберите и установите новейшую версию из списка доступных.

<h4 id="mac">Mac OS X</h4>

<p>Вам нужно будет установить метапакет Xcode Tools, запустив:
<pre>
open /Applications/Installers/Xcode\ Tools/XcodeTools.mpkg
</pre>

<p>Если это недоступно в вашей системе, вам необходимо установить его с установочного компакт-диска Mac OS X. Кроме того, вы можете загрузить копию пройдя по ссылке <a href="http://developer.apple.com/TOOLS/Xcode/">
<p>Затем вы можете установить другие зависимости, используя MacPorts, запустив:

<pre>
port install icu erlang spidermonkey curl
</pre>

<p>Подробнее читайте на <a href="mac.html">Приложения B, Установка в Mac OS X </a>.
<h3 id="installing">Установка</h3>

<p>После установки всех зависимостей вы можите загрузить копию исходных файлов <a href="http://couchdb.apache.org/downloads.html">СУБД CouchDB </a>. Это архив, который вам нужно будет распаковать. Откройте терминал и перейдите в папку с распакованным архивом.
<p>Настройте источник, выполнив:

<pre>
./configure
</pre>

<p>Мы собираемся установить CouchDB в папку <code>/usr/local</code>, которая является местоположением по умолчанию для установленного пользователем программного обеспечения. Для этой команды доступно множество параметров, и вы можете настроить все, начиная от места установки, например, от вашего домашнего каталога, до места установки Erlang или SpiderMonkey.
<p>Чтобы увидеть, что доступно, вы можете запустить:

<pre>
./configure --help
</pre>

<p>Как правило, вы можете игнорировать этот шаг, если вы не получили никаких ошибок при первом запуске. Вам нужно будет только передать дополнительные параметры, если ваши настройки нестандартные и у скрипта возникают проблемы с поиском одной из зависимостей, которые вы установили в последнем разделе.
<p>
Если все прошло успешно, вы должны увидеть следующее сообщение:
<pre>
You have configured Apache CouchDB, time to relax.
</pre>

<p>Relax.

<p>Выполните и установите исходный код, выполнив:
<pre>
make &amp;&amp; sudo make install
</pre>

<p>Если вы изменили место установки на какое-то временное, вы можете не использовать здесь команду <code>sudo</code>. Если у вас возникли проблемы с запуском <code>make</code>, вы можете попробовать запустить <code>gmake</code>, если он доступен в вашей системе. Дополнительные параметры можно найти, прочитав файл <code>INSTALL</code>.
<h3 id="security">Вопросы безопасности</h3>

<p>Не рекомендуется запускать сервер CouchDB от имени администратора. Если к серверу CouchDB получат доступ злоумышленником во время его работы администратором, злоумышленник получит доступ ко всей вашей системе. А это не то, что мы хотим!
<p>Мы настоятельно рекомендуем вам создать конкретного пользователя для CouchDB. У этого пользователя должно быть как можно меньше привилегий в вашей системе, желательно минимум, необходимый для запуска сервера CouchDB, чтения файлов конфигурации и записи в каталоги данных и журналов.
<p>Вы можете использовать любой инструмент, предоставляемый вашей системой, для создания нового пользователя <code>couchdb</code>.
<p>На многих Unix-подобных системах вы можете запустить:
<pre>
adduser --system --home /usr/local/var/lib/couchdb --no-create-home --shell /bin/bash --group --gecos "CouchDB" couchdb
</pre>

<p>Mac OS X предоставляет стандартную опцию «Учетные записи» из приложения «Системные настройки», или вы можете использовать приложение «Workgroup Manager», которое можно загрузить как часть <a href = "http://www.apple.com/support/downloads/serveradmintools1047.html ">Инструменты администратора сервера</a>.
<p>Убедитесь, что у пользователя <code>couchdb</code>есть работающая оболочка для входа. Вы можете проверить это, войдя в терминал как пользователь <code>couchdb</code>. Вы также должны убедиться, что домашний каталог установлен в <code>/usr/local/var/lib/couchdb </code>, который является каталогом базы данных CouchDB.
<p>Измените владельца каталогов CouchDB, запустив:

<pre>
chown -R couchdb:couchdb /usr/local/etc/couchdb
chown -R couchdb:couchdb /usr/local/var/lib/couchdb
chown -R couchdb:couchdb /usr/local/var/log/couchdb
chown -R couchdb:couchdb /usr/local/var/run/couchdb
</pre>

<p>Измените разрешение каталогов CouchDB, запустив:

<pre>
chmod -R 0770 /usr/local/etc/couchdb
chmod -R 0770 /usr/local/var/lib/couchdb
chmod -R 0770 /usr/local/var/log/couchdb
chmod -R 0770 /usr/local/var/run/couchdb
</pre>

<p>Это ещё не всео вопросы о защите вашей настройки CouchDB. Если вы развертываете CouchDB в Интернете или в любом месте, где ненадежные стороны могут получить доступ к вашему серверу, вам следует изучить рекомендуемые меры безопасности для вашей операционной системы и предпринять любые дополнительные необходимые шаги. Имейте в виду пословицу о сетевой безопасности, согласно которой единственный способ надлежащей защиты компьютерной системы - отключить ее от сети.
<h3 id="manually">Установка вручную</h3>

<p>Вы можете запустить сервер CouchDB, выполнив:
<pre>
sudo -i -u couchdb couchdb -b
</pre>

<p>При этом команда <code>sudo </code>используется для запуска команды <code>couchdb </code>от имени пользователя <code>couchdb </code>.
<p>Когда CouchDB запуститься должно появиться следующее сообщение:

<pre>
Apache CouchDB has started, time to relax.
</pre>

<p>Relax.

<p>TЧтобы убедиться, что все работает, перейдите на страницу в браузере на:
<pre>
http://127.0.0.1:5984/_utils/index.html
</pre>

<p>Это Futon, консоль веб-администрирования CouchDB. Мы рассмотрели основы Futon в наших первых главах. Как только вы загрузите его, вы должны выбрать и запустить CouchDB Test Suite из правого меню. Это позволит убедиться, что все ведет себя так, как ожидалось, и может избавить вас от серьезных головных болей, если что-то окажется не очень удачным.
<h3 id="daemon">Запуск CouchDB в фоновом режиме</h3>

<p>После того, как CouchDB будет работать нормально, вы, вероятно, захотите запустить его в фоновом режиме (как демон (demon)). Демон - это программное приложение, которое постоянно работает в фоновом режиме, ожидая обработки запросов. Именно так работают большинство серверов производственной базы данных, и вы также можете настроить CouchDB для такой работы.

<p>Когда вы запускаете CouchDB в качестве демона, он создать несколько файлов, описывающие его действия (так называемых лог-файлов), которые возможно, придётся очищать время от времени, так сишком большые файлы могут заполнить всё существующее дисковое пространство. Некоторые операционные системы поставляются с программным обеспечением, которое делает это за вас, и для вас важно изучить свои варианты и предпринять необходимые шаги, чтобы убедиться, что это не станет проблемой. CouchDB поставляется с конфигурацией <code>logrotate </code>, которая может быть полезна.
<h4 id="init">Системы SysV/BSD</h4>

<p>В зависимости от вашей операционной системы сценарий демона <code>couchdb </code>может быть установлен в каталог с именем <code>init.d </code>(для систем в стиле SysV) или <code>rc.d </code>(для систем в стиле BSD) в каталоге <code>/usr/local/etc </code>. В следующих примерах используется <code>[init.d | rc.d] </code>, чтобы указать этот выбор, и перед выполнением любой из этих команд вы должны заменить его своим действительным каталогом.
<p>Вы можете запустить демон CouchDB следующим образом:
<pre>
sudo /usr/local/etc/[init.d|rc.d]/couchdb start
</pre>

<p>Остановка демона CouchDB:

<pre>
sudo /usr/local/etc/[init.d|rc.d]/couchdb stop
</pre>

<p>Получить информацию о состоянии демона CouchDB:

<pre>
sudo /usr/local/etc/[init.d|rc.d]/couchdb status
</pre>

<p>Если вы хотите настроить работу скрипта-демона, вы найдете несколько параметров, которые вы можете редактировать, в файле <code>/usr/local/etc/default/couchdb </code>.
<p>Если вы хотите запустить скрипт без команды <code>sudo </code>, вам необходимо удалить параметр <code>COUCHDB_USER </code>из этого файла.
<p>Ваша операционная система, вероятно, предоставит способ автоматического управления демоном CouchDB, запуская и останавливая его как системную службу. Для этого вам необходимо скопировать скрипт-демон в вашу системную директорию <code>/etc/[init.d | rc.d] </code>и выполнить такую команду:
<pre>
sudo update-rc.d couchdb defaults
</pre>

<p>Для более подробной информации обратитесь к документации.

<h4 id="launchd">Mac OS X</h4>

<p>Вы можете использовать систему <code>launchd </code>для управления демоном CouchDB.

<p>Вы можете загрузить конфигурацию <code>launchd </code>, выполнив:

<pre>
sudo launchctl load /usr/local/Library/LaunchDaemons/org.apache.couchdb.plist
</pre>

<p>Вы можете выгрузить конфигурацию <code>launchd </code>, выполнив:

<pre>
sudo launchctl unload /usr/local/Library/LaunchDaemons/org.apache.couchdb.plist
</pre>

<p>Вы можете запустить демон CouchDB, запустив:

<pre>
sudo launchctl start org.apache.couchdb
</pre>

<p>Вы можете остановить демон CouchDB, запустив:

<pre>
sudo launchctl stop org.apache.couchdb
</pre>

<p>Система <code>launchd </code>может автоматически управлять демоном CouchDB, запуская и останавливая его как системную службу. Для этого вам необходимо скопировать файл plist в системный каталог <code>/Library/LaunchDaemons </code>.

<p>Обратитесь к документации <code>launchd </code>для получения дополнительной информации.

<h3 id="troubleshooting">Исправление ошибок</h3>

<p>Программное обеспечение предоставляется как есть. Вы можете рассчитывать на то, что что-то идет не так, время от времени. Не нужно паниковать; CouchDB имеет большое сообщество людей, которые смогут ответить на ваши вопросы и помочь вам начать работу. Вот несколько ресурсов, которые помогут вам на вашем пути:
<ul>

<li>Если вы получаете сообщение об ошибке, зайте на страницу <a href="http://wiki.apache.org/couchdb/Error_messages">Error Messages wiki</a>.</li>

<li>Типичные проблемы и их решения описаны на странице <a href="http://wiki.apache.org/couchdb/Troubleshooting">Troubleshooting steps</a>.</li>

<li>Если вы не нашли решения появившейся проблемы, переходите на страницу <a href="http://couchdb.apache.org/community/lists.html">mailing lists</a>.</li>

</ul>

<p>Don’t forget to use your favorite search engine when diagnosing problems. If you look around a bit, you’re likely to find something. It’s very possible that a bunch of other people have had exactly the same problem as you and a solution has been posted somewhere on the Web. Good luck, and remember to relax!
Не забывайте использовать свою любимую поисковую систему при диагностике проблем. Если вы немного поищите, вы наверняка что-то найдете. Вполне возможно, что у других людей возникла точно такая же проблема, как и у вас, и решение было опубликовано где-то в Интернете. Удачи, и не забудьте о relax!